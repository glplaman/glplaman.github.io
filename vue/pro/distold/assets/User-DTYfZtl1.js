import{_ as H,l as R,r as d,m as V,o as q,c as p,d as e,j as c,F as y,e as C,u as i,q as w,v as M,s as A,x as L,h as O,y as T,i as G,b as _,t as k,n as B,f as J,z as K,p as P,k as Q}from"./index-BXEbfFZd.js";import{u as W,w as X}from"./xlsx-ChWuxSKv.js";const u=m=>(P("data-v-e3bd103f"),m=m(),Q(),m),Y={class:"user"},Z={class:"btns-box"},ee=u(()=>e("span",{class:"iconfont icon-customer-fill"},null,-1)),le=u(()=>e("span",{class:"iconfont icon-change"},null,-1)),se=u(()=>e("span",{class:"iconfont icon-excel-full"},null,-1)),te=u(()=>e("tr",{class:"tbl-header"},[e("th",null,[c("学号"),e("br"),e("span",null,"usn")]),e("th",null,[c("姓名"),e("br"),e("span",null,"uname")]),e("th",null,[c("头像"),e("br"),e("span",null,"uavatar")]),e("th",null,[c("积分"),e("br"),e("span",null,"ucredit")]),e("th",null,[c("操作"),e("br"),e("span",null,"uoper")])],-1)),ae={hidden:""},oe=["src"],ne={class:"btn-group"},ue=["onClick"],ie=u(()=>e("span",{class:"iconfont icon-edit"},null,-1)),ce=[ie],re=["onClick"],de=u(()=>e("span",{class:"iconfont icon-delete-fill"},null,-1)),ve=[de],pe={key:0,class:"add-user-wrap"},_e=u(()=>e("h3",{class:"dia-title"},"add user",-1)),fe={class:"dia-cont"},he={class:"add-item"},be=u(()=>e("span",null,"学号",-1)),me={class:"add-item"},ge=u(()=>e("span",null,"姓名",-1)),ke={class:"add-item"},xe=u(()=>e("span",null,"头像",-1)),ye={class:"img-box"},Ce=["value"],we={class:"add-item"},Se=u(()=>e("span",null,"积分",-1)),Ue=["onClick"],Ie=u(()=>e("button",{class:"add",type:"submit"},[c("提交 "),e("span",{class:"iconfont icon-tick"})],-1)),Ve=u(()=>e("span",{class:"iconfont icon-close"},null,-1)),Me={__name:"User",setup(m){const D=R("axios");let f=d(null),x=d(null),h=d([]),g=d(!1),v=d(-1),t=d(!1),a=d({usn:"",uname:"",uavatar:"",ucredit:0}),o=d(null);const S=l=>{g.value=!0,l&&(a.value={...l})},E=l=>{console.log(l),h.value.splice(l,1)},F=()=>{g.value=!1,t.value=!1,I()},N=()=>{if(!a.value.usn){console.log("user sn is null"),console.log(t.value),t.value=!0,o.value&&(o.value.tips="user sn is null",console.log(o.value.tips));return}if(!a.value.uname){console.log("user name is null"),console.log(t.value),t.value=!0,o.value&&(o.value.tips="user name is null",console.log(o.value.tips));return}if(!a.value.uavatar){console.log("user avatar is null"),console.log(t.value),t.value=!0,o.value&&(o.value.tips="user avatar is null",console.log(o.value.tips));return}if(!a.value.ucredit){console.log("user credit is null"),t.value=!0,o.value&&(o.value.tips="user credit is null",console.log(o.value.tips));return}g.value=!1,t.value=!1,h.value.unshift(a.value),I()},j=l=>{console.log(l),a.value.ucredit=l+1},z=()=>{if(x.value){let l=W.table_to_book(x.value);X(l,"user.xlsx")}else console.log("tbl is null")},U=()=>{D.get("https://glpla.github.io/utils/data/data2024/rank202401.json").then(l=>{h.value=[...h.value,...l.data.cont]})};V(v,(l,n)=>{a.value.uavatar="/avatar/avatar"+l+".png"},{immediate:!0}),V(t,(l,n)=>{l&&setTimeout(()=>{t.value=!1},3e3)}),q(()=>{U(),f.value.onscroll=l=>{f.value.scrollTop/(f.value.scrollHeight-f.value.offsetHeight)>=.8&&U()}});const I=()=>{a.value={usn:"",uname:"",uavatar:"",ucredit:0},v.value=-1};return(l,n)=>{const $=G("Tips");return _(),p("div",Y,[e("div",Z,[e("button",{class:"btn add-user-btn",onClick:S},[c("添加用户 "),ee]),e("button",{class:"btn add-user-btn",onClick:n[0]||(n[0]=(...s)=>l.reloadData&&l.reloadData(...s))},[c("刷新数据 "),le]),e("button",{class:"btn add-user-btn",onClick:z},[c("导出Excel "),se])]),e("div",{class:"tbl-box",ref_key:"tblBox",ref:f},[e("table",{ref_key:"tbl",ref:x},[te,(_(!0),p(y,null,C(i(h),(s,r)=>(_(),p("tr",{key:s.id},[e("td",null,k(s.usn),1),e("td",null,k(s.uname),1),e("td",null,[e("span",ae,k(s.uavatar),1),e("img",{class:"img-avatar",src:"https://glpla.github.io/utils"+s.uavatar,alt:"user avatar"},null,8,oe)]),e("td",null,k(s.ucredit),1),e("td",ne,[e("button",{class:"btn edit-btn",onClick:b=>S(s)},ce,8,ue),e("button",{class:"btn del-btn",onClick:b=>E(r)},ve,8,re)])]))),128))],512)],512),i(g)?(_(),p("div",pe,[e("form",{onSubmit:A(N,["prevent"])},[_e,e("div",fe,[e("div",he,[be,w(e("input",{type:"text",placeholder:"your sn",name:"usn","onUpdate:modelValue":n[1]||(n[1]=s=>i(a).usn=s)},null,512),[[M,i(a).usn,void 0,{trim:!0}]])]),e("div",me,[ge,w(e("input",{type:"text",placeholder:"your name",name:"uname","onUpdate:modelValue":n[2]||(n[2]=s=>i(a).uname=s)},null,512),[[M,i(a).uname,void 0,{trim:!0}]])]),e("div",ke,[xe,e("div",ye,[(_(),p(y,null,C(10,(s,r)=>e("label",{class:B(["avatar-img",{active:i(v)==r}]),style:J({backgroundImage:"url(https://glpla.github.io/utils/avatar/avatar"+r+".png)"})},[w(e("input",{type:"radio",name:"uavatar",value:r,"onUpdate:modelValue":n[3]||(n[3]=b=>T(v)?v.value=b:v=b),hidden:""},null,8,Ce),[[K,i(v)]])],6)),64))])]),e("div",we,[Se,e("div",null,[(_(),p(y,null,C(10,(s,r)=>e("span",{class:B(["iconfont icon-favorites credit-icon",{active:r<i(a).ucredit}]),key:s,onClick:b=>j(r)},null,10,Ue)),64))])]),e("div",{class:"btn-group"},[Ie,e("button",{class:"cancle",type:"button",onClick:F},[c("取消 "),Ve])])])],32)])):L("",!0),O($,{ref_key:"modal",ref:o,show:i(t),onEmitModal:n[4]||(n[4]=s=>T(t)?t.value=!1:t=!1)},null,8,["show"])])}}},De=H(Me,[["__scopeId","data-v-e3bd103f"]]);export{De as default};
