import{u as F}from"./cart-BDOmEebu.js";import{a as V,r as j,k as z,S as U}from"./Tabbar.vue_vue_type_style_index_0_scoped_07715eb8_lang-EYH-15_Z.js";import{_ as C,o as v,c as _,a as t,r as u,w as S,b as M,d as q,v as D,t as i,e as g,F as N,f as B,u as I,g as k,h as R,i as y,n as L,j as $,k as A,l as E,m as G}from"./index-DutQLsQK.js";const K={},P={class:"search"},T={class:"clear",ref:"clear-ref"};function H(x,o){return v(),_("div",P,[o[1]||(o[1]=t("span",{class:"iconfont icon-sousuo_o"},null,-1)),o[2]||(o[2]=t("input",{class:"ipt",type:"text",placeholder:"小黄杏美式"},null,-1)),t("div",T,o[0]||(o[0]=[t("span",{class:"iconfont icon-guanbi_o"},null,-1)]),512)])}const J=C(K,[["render",H],["__scopeId","data-v-db721673"]]),O={class:"cont"},Q={class:"header"},W={class:"all"},X={for:"all"},Y=["value"],Z=["src"],tt={class:"info"},st={class:"title"},et={class:"sub-title"},at={class:"price-new"},nt={class:"price-old"},ot={class:"oper"},lt=["onClick"],it={class:"num"},ct=["onClick"],rt={class:"cart-num f-s-s"},ut={class:"price"},dt={class:"total-price f-s-m f-b"},pt={class:"total-promotion f-s-s"},vt={__name:"Cart",setup(x){const o=u(!1),c=F(),l=u([...c.cart]),r=u(!0),m=u(0),f=u(0);let h=!0;S(l,()=>{l.value.length===c.cart.length?(r.value=!0,h=!0):(r.value=!1,h=!1),m.value=l.value.reduce((a,s)=>a+s.price*s.quantity*(1-s.discount),0),f.value=l.value.reduce((a,s)=>a+s.quantity,0)},{deep:!0,immediate:!0}),S(r,a=>{a?l.value=c.cart:h&&(l.value=[])});const b=()=>{c.clearCart(),l.value=[],r.value=!1},d=()=>{o.value=!1},e=()=>c.cart.reduce((a,s)=>a+s.price*s.discount*s.quantity,0);return M(()=>{console.log("cart loading",c.cart)}),(a,s)=>{const p=$("router-link");return v(),_("div",{class:L(["cart",{"show-cont-all":o.value}]),onClick:g(d,["self"])},[t("div",O,[t("header",Q,[t("div",W,[q(t("input",{type:"checkbox",id:"all","onUpdate:modelValue":s[0]||(s[0]=n=>r.value=n)},null,512),[[D,r.value]]),t("label",X,"已选择商品（"+i(f.value)+"件）",1)]),t("button",{class:"clear",onClick:g(b,["stop"])},s[3]||(s[3]=[t("span",{class:"iconfont icon-shanchu_o"},null,-1),t("span",null,"清空购物车",-1)]))]),(v(!0),_(N,null,B(I(c).cart,(n,gt)=>(v(),_("div",{class:"item",key:n.id},[q(t("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":s[1]||(s[1]=w=>l.value=w),value:n},null,8,Y),[[D,l.value]]),t("img",{class:"img",src:`https://glpla.github.io/utils${n.img}`,alt:""},null,8,Z),t("div",tt,[t("h3",st,i(n.name),1),t("div",et,i(n.desc),1),t("div",null,[t("span",at,"¥"+i(n.price),1),t("span",nt,"¥"+i(n.price_original),1)])]),t("div",ot,[t("button",{class:"btn dec",onClick:w=>n.quantity--},"-",8,lt),t("span",it,i(n.quantity),1),t("button",{class:"btn inc",onClick:w=>n.quantity++},"+",8,ct)])]))),128))]),t("footer",null,[t("button",{class:"btn cart-left",onClick:s[2]||(s[2]=g(n=>o.value=!o.value,["stop"]))},[s[4]||(s[4]=t("span",{class:"iconfont icon-icon_ruixingkafei"},null,-1)),t("span",rt,i(f.value),1)]),t("div",ut,[t("div",null,[s[5]||(s[5]=t("span",null,"预计到手 ",-1)),t("span",dt,"¥"+i(m.value.toFixed(2)),1)]),t("div",pt,[s[6]||(s[6]=t("span",null,"已享受更多优惠，共减免 ",-1)),t("span",null,"¥"+i(e().toFixed(2)),1)])]),k(p,{class:"btn pay-btn f-s-b",to:"/order"},{default:R(()=>s[7]||(s[7]=[y("去结算")])),_:1})])],2)}}},_t=C(vt,[["__scopeId","data-v-6e637071"]]),ft={class:"menu-view"},ht={class:"header"},kt={class:"f-b"},mt={class:"links"},bt={class:"sub-view p-1"},wt={__name:"MenuView",setup(x){const o=F(),c=G("axios"),l=u({}),r=u({}),m=u({}),f=u({}),h=[{ind:0,title:"经典菜单",path:"/menu/goods",keyword:"classic"},{ind:1,title:"会员卡",path:"/menu/vip",keyword:"member"},{ind:2,title:"年度封神榜",path:"/menu/rank",keyword:"rank"},{ind:3,title:"我的常点",path:"/menu/favorite",keyword:"favor"}],b=u([{title:"自提"},{title:"外送"}]);return M(()=>{c.get(`/map-api/ws/location/v1/ip?ip=&key=${V}`).then(d=>{r.value=d.data.result.location||{lat:23.060754,lng:113.580752},c.get(`/map-api/ws/place/v1/search?boundary=nearby(${r.value.lat},${r.value.lng},${j})&keyword=${z}&page_size=10&page_index=1&key=${V}`).then(e=>{l.value={title:e.data.data[0].title.replace(/瑞幸咖啡\(/,"").replace(/\)/,""),distance:e.data.data[0]._distance.toFixed(0)},m.value=e.data.data.map(a=>({...a,open:"08:30 - 21:30"})),f.value=e.data.data.map(a=>({styleId:"marker",position:a.location,content:a.title}))})})}),(d,e)=>{const a=$("RouterLink"),s=$("RouterView");return v(),_("div",ft,[t("div",ht,[k(U,{switchs:b.value},null,8,["switchs"]),k(J,{class:"search",onClick:e[0]||(e[0]=p=>d.$router.push("/search"))})]),t("div",{class:"loc-box",onClick:e[1]||(e[1]=p=>d.$router.push("/location"))},[e[2]||(e[2]=t("span",{class:"iconfont icon-didiandingwei_o"},null,-1)),t("span",null,[t("span",kt,i(l.value.title),1),y(" | "+i(l.value.distance)+"m",1)]),e[3]||(e[3]=t("button",null,">",-1))]),t("div",mt,[(v(),_(N,null,B(h,(p,n)=>k(a,{class:"link f-b",key:p.id,to:p.path},{default:R(()=>[y(i(p.title),1)]),_:2},1032,["to"])),64))]),t("div",bt,[k(s)]),I(o).cart.length?(v(),A(_t,{key:0,class:L(["w cart",{pos:d.$route.meta.showNav}])},null,8,["class"])):E("",!0)])}}},xt=C(wt,[["__scopeId","data-v-734fe6c2"]]);export{xt as default};
