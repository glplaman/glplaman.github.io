import{u as q}from"./cart-ClGxpU6X.js";import{a as C,r as T,k as j,S as z}from"./Tabbar.vue_vue_type_style_index_0_scoped_ec820afd_lang-d9uF6APE.js";import{_ as y,o as d,c as _,a as t,u as U,b as A,r as u,F as I,d as D,n as g,w,t as r,e as E,f as x,g as F,h as S,v as V,i as M,j as h,k as G,l as N,m as B,p as K,q as L,s as O}from"./index-iQDPzft7.js";const P={},H={class:"search"},J={class:"clear",ref:"clear-ref"};function Q(m,e){return d(),_("div",H,[e[1]||(e[1]=t("span",{class:"iconfont icon-sousuo_o"},null,-1)),e[2]||(e[2]=t("input",{class:"ipt",type:"text",placeholder:"小黄杏美式"},null,-1)),t("div",J,e[0]||(e[0]=[t("span",{class:"iconfont icon-guanbi_o"},null,-1)]),512)])}const W=y(P,[["render",Q],["__scopeId","data-v-db721673"]]),X={class:"tabbar",ref:"tabbar"},Y=["onClick"],Z={__name:"Tabbar",props:["tabs"],setup(m){const e=U();A();const i=u(0),a=n=>{e.push(n.path),i.value=n.ind};return(n,b)=>(d(),_("div",X,[(d(!0),_(I,null,D(m.tabs,(p,v)=>(d(),_("button",{key:v,class:g(["tab-item",{active:i.value===v}]),onClick:w(k=>a(p),["stop"])},[t("h3",null,r(p.title),1)],10,Y))),128)),E(n.$slots,"default",{},void 0)],512))}},tt=y(Z,[["__scopeId","data-v-ec820afd"]]),st={class:"cont"},et={class:"header"},at={class:"all"},nt={for:"all"},ot=["value"],lt=["src"],it={class:"info"},ct={class:"title"},rt={class:"sub-title"},ut={class:"price-new"},dt={class:"price-old"},pt={class:"oper"},vt=["onClick"],_t={class:"num"},ft=["onClick"],bt={class:"cart-num f-s-s"},ht={class:"price"},mt={class:"total-price f-s-m f-b"},kt={class:"total-promotion f-s-s"},wt={__name:"Cart",setup(m){const e=u(!1),i=q(),a=u([...i.cart]),n=u(!0),b=u(0),p=u(0);let v=!0;x(a,()=>{a.value.length===i.cart.length?(n.value=!0,v=!0):(n.value=!1,v=!1),b.value=a.value.reduce((l,s)=>l+s.price*s.quantity*(1-s.discount),0),p.value=a.value.reduce((l,s)=>l+s.quantity,0)},{deep:!0,immediate:!0}),x(n,l=>{l?a.value=i.cart:v&&(a.value=[])});const k=()=>{i.clearCart(),a.value=[],n.value=!1},f=()=>{e.value=!1},o=()=>i.cart.reduce((l,s)=>l+s.price*s.discount*s.quantity,0);return F(()=>{console.log("cart loading",i.cart)}),(l,s)=>{const R=B("router-link");return d(),_("div",{class:g(["cart",{"show-cont-all":e.value}]),onClick:w(f,["self"])},[t("div",st,[t("header",et,[t("div",at,[S(t("input",{type:"checkbox",id:"all","onUpdate:modelValue":s[0]||(s[0]=c=>n.value=c)},null,512),[[V,n.value]]),t("label",nt,"已选择商品（"+r(p.value)+"件）",1)]),t("button",{class:"clear",onClick:w(k,["stop"])},s[3]||(s[3]=[t("span",{class:"iconfont icon-shanchu_o"},null,-1),t("span",null,"清空购物车",-1)]))]),(d(!0),_(I,null,D(M(i).cart,(c,St)=>(d(),_("div",{class:"item",key:c.id},[S(t("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":s[1]||(s[1]=$=>a.value=$),value:c},null,8,ot),[[V,a.value]]),t("img",{class:"img",src:`https://glpla.github.io/utils${c.img}`,alt:""},null,8,lt),t("div",it,[t("h3",ct,r(c.name),1),t("div",rt,r(c.desc),1),t("div",null,[t("span",ut,"¥"+r(c.price),1),t("span",dt,"¥"+r(c.priceOrignal),1)])]),t("div",pt,[t("button",{class:"btn dec",onClick:$=>c.quantity--},"-",8,vt),t("span",_t,r(c.quantity),1),t("button",{class:"btn inc",onClick:$=>c.quantity++},"+",8,ft)])]))),128))]),t("footer",null,[t("button",{class:"btn cart-left",onClick:s[2]||(s[2]=w(c=>e.value=!e.value,["stop"]))},[s[4]||(s[4]=t("span",{class:"iconfont icon-icon_ruixingkafei"},null,-1)),t("span",bt,r(p.value),1)]),t("div",ht,[t("div",null,[s[5]||(s[5]=t("span",null,"预计到手 ",-1)),t("span",mt,"¥"+r(b.value.toFixed(2)),1)]),t("div",kt,[s[6]||(s[6]=t("span",null,"已享受更多优惠，共减免 ",-1)),t("span",null,"¥"+r(o().toFixed(2)),1)])]),h(R,{class:"btn pay-btn f-s-b",to:"/order"},{default:G(()=>s[7]||(s[7]=[N("去结算")])),_:1})])],2)}}},yt=y(wt,[["__scopeId","data-v-a456b60e"]]),$t={class:"menu-view p-b-10"},gt={class:"header"},Ct={class:"f-b"},xt={__name:"MenuView",setup(m){const e=q(),i=O("axios"),a=u({}),n=u({}),b=u({}),p=u({}),v=[{ind:0,title:"经典菜单",path:"/menu",keyword:"classic"},{ind:1,title:"会员卡",path:"/menu/vip",keyword:"member"},{ind:2,title:"年度封神榜",path:"/menu/rank",keyword:"rank"},{ind:3,title:"我的常点",path:"/menu/favorite",keyword:"favor"}],k=u([{title:"自提"},{title:"外送"}]);return F(()=>{i.get(`/map-api/ws/location/v1/ip?ip=&key=${C}`).then(f=>{n.value=f.data.result.location||{lat:23.060754,lng:113.580752},i.get(`/map-api/ws/place/v1/search?boundary=nearby(${n.value.lat},${n.value.lng},${T})&keyword=${j}&page_size=10&page_index=1&key=${C}`).then(o=>{a.value={title:o.data.data[0].title.replace(/瑞幸咖啡\(/,"").replace(/\)/,""),distance:o.data.data[0]._distance.toFixed(0)},b.value=o.data.data.map(l=>({...l,open:"08:30 - 21:30"})),p.value=o.data.data.map(l=>({styleId:"marker",position:l.location,content:l.title}))})})}),(f,o)=>{const l=B("RouterView");return d(),_("div",$t,[t("div",gt,[h(z,{switchs:k.value},null,8,["switchs"]),h(W,{class:"search",onClick:o[0]||(o[0]=s=>f.$router.push("/search"))})]),t("div",{class:"loc-box",onClick:o[1]||(o[1]=s=>f.$router.push("/location"))},[o[2]||(o[2]=t("span",{class:"iconfont icon-didiandingwei_o"},null,-1)),t("span",null,[t("span",Ct,r(a.value.title),1),N(" | "+r(a.value.distance)+"m",1)]),o[3]||(o[3]=t("button",null,">",-1))]),h(tt,{tabs:v}),h(l,{class:"sub-view p-1"}),M(e).cart.length?(d(),K(yt,{key:0,class:g(["w cart",{pos:f.$route.meta.showNav}])},null,8,["class"])):L("",!0)])}}},Dt=y(xt,[["__scopeId","data-v-64eaa42e"]]);export{Dt as default};
