import{u as M}from"./cart-pihbF62N.js";import{a as q,r as L,k as U,S as z}from"./Tabbar.vue_vue_type_style_index_0_scoped_07715eb8_lang-BzgRADjb.js";import{_ as $,o as u,c as m,a as t,m as A,u as P,w as I,v as D,t as r,r as d,b as S,d as E,e as F,f as w,F as N,g as B,h,i as R,j as k,k as C,l as x,n as j,p as V,q as G,s as O,x as T,K as H}from"./index-CmfoU7ii.js";const J={},Q={class:"search"},W={class:"clear",ref:"clear-ref"};function X(l,a){return u(),m("div",Q,[a[1]||(a[1]=t("span",{class:"iconfont icon-sousuo_o"},null,-1)),a[2]||(a[2]=t("input",{class:"ipt",type:"text",placeholder:"小黄杏美式"},null,-1)),t("div",W,a[0]||(a[0]=[t("span",{class:"iconfont icon-guanbi_o"},null,-1)]),512)])}const Y=$(J,[["render",X],["__scopeId","data-v-db721673"]]),Z={class:"cart-item"},tt=["value"],et=["src"],st={class:"info"},at={class:"title"},lt={class:"sub-title"},nt={class:"price-new"},ot={class:"price-old"},it={class:"oper"},ct=["disabled"],rt={class:"num"},ut=["disabled"],dt={__name:"CartItem",props:A({cart:{type:Object,default:{}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const a=P(l,"modelValue");return(o,n)=>(u(),m("div",Z,[I(t("input",{type:"checkbox",name:"cart","onUpdate:modelValue":n[0]||(n[0]=i=>a.value=i),value:l.cart},null,8,tt),[[D,a.value]]),t("img",{class:"img",src:`https://glpla.github.io/utils${l.cart.img}`,alt:""},null,8,et),t("div",st,[t("h3",at,r(l.cart.name),1),t("div",lt,r(l.cart.desc),1),t("div",null,[t("span",nt,"¥"+r(l.cart.price),1),t("span",ot,"¥"+r(l.cart.price_original),1)])]),t("div",it,[t("button",{class:"btn dec",onClick:n[1]||(n[1]=i=>l.cart.quantity--),disabled:l.cart.quantity==1},"-",8,ct),t("span",rt,r(l.cart.quantity),1),t("button",{class:"btn inc",onClick:n[2]||(n[2]=i=>l.cart.quantity++),disabled:l.cart.quantity>=l.cart.stock},"+",8,ut)])]))}},vt=$(dt,[["__scopeId","data-v-2cda3e0a"]]),pt={class:"cont"},mt={class:"header"},ft={class:"all"},_t={for:"all"},kt={class:"cart-num f-s-s"},bt={class:"price"},ht={class:"total-price f-s-m f-b"},$t={class:"total-promotion f-s-s"},yt={__name:"Cart",setup(l){const a=M(),o=d([...a.cart]),n=d(!0),i=d(!0),b=d(0),f=d(0);let _=!0;S(o,()=>{o.value.length===a.cart.length?(i.value=!0,_=!0):(i.value=!1,_=!1),b.value=o.value.reduce((s,e)=>s+e.quantity*e.price*(1-e.discount),0),f.value=o.value.reduce((s,e)=>s+e.quantity,0)},{deep:!0,immediate:!0}),S(i,s=>{s?o.value=a.cart:_&&(o.value=[])});const y=E(()=>{let s=o.value.reduce((e,p)=>e+p.quantity*p.price*p.discount,0);return console.log(s),s.toFixed(2)}),v=()=>{a.clearCart(),o.value=[],i.value=!1};return F(()=>{console.log("cart loading",a.cart)}),(s,e)=>{const p=V("router-link");return u(),m("div",{class:j(["cart",{"show-cont-all":n.value}]),onClick:e[3]||(e[3]=w(c=>n.value=!1,["self"]))},[t("div",pt,[t("header",mt,[t("div",ft,[I(t("input",{type:"checkbox",id:"all","onUpdate:modelValue":e[0]||(e[0]=c=>i.value=c)},null,512),[[D,i.value]]),t("label",_t,"已选择商品（"+r(f.value)+"件）",1)]),t("button",{class:"clear",onClick:w(v,["stop"])},e[4]||(e[4]=[t("span",{class:"iconfont icon-shanchu_o"},null,-1),t("span",null,"清空购物车",-1)]))]),(u(!0),m(N,null,B(R(a).cart,(c,g)=>(u(),h(vt,{key:c.id,cart:c,modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=K=>o.value=K)},null,8,["cart","modelValue"]))),128))]),t("footer",null,[t("button",{class:"btn cart-left",onClick:e[2]||(e[2]=w(c=>n.value=!n.value,["stop"]))},[e[5]||(e[5]=t("span",{class:"iconfont icon-icon_ruixingkafei"},null,-1)),t("span",kt,r(f.value),1)]),t("div",bt,[t("div",null,[e[6]||(e[6]=t("span",null,"预计到手 ",-1)),t("span",ht,"¥"+r(b.value.toFixed(2)),1)]),t("div",$t,[e[7]||(e[7]=t("span",null,"已享受更多优惠，共减免 ",-1)),t("span",null,"¥"+r(y.value),1)])]),k(p,{class:"btn pay-btn f-s-b",to:"/order"},{default:C(()=>e[8]||(e[8]=[x("去结算")])),_:1})])],2)}}},gt=$(yt,[["__scopeId","data-v-e6af764b"]]),wt={class:"menu-view"},Ct={class:"header"},xt={class:"f-b"},Vt={class:"links"},qt={class:"sub-view p-1"},St={__name:"MenuView",setup(l){const a=M(),o=O("axios"),n=d({}),i=d({}),b=d({}),f=d({}),_=[{ind:0,title:"经典菜单",path:"/menu/goods",keyword:"classic"},{ind:1,title:"会员卡",path:"/menu/vip",keyword:"member"},{ind:2,title:"年度封神榜",path:"/menu/rank",keyword:"rank"},{ind:3,title:"我的常点",path:"/menu/favorite",keyword:"favor"}],y=d([{title:"自提"},{title:"外送"}]);return F(()=>{o.get(`/map-api/ws/location/v1/ip?ip=&key=${q}`).then(v=>{i.value=v.data.result.location||{lat:23.060754,lng:113.580752},o.get(`/map-api/ws/place/v1/search?boundary=nearby(${i.value.lat},${i.value.lng},${L})&keyword=${U}&page_size=10&page_index=1&key=${q}`).then(s=>{n.value={title:s.data.data[0].title.replace(/瑞幸咖啡\(/,"").replace(/\)/,""),distance:s.data.data[0]._distance.toFixed(0)},b.value=s.data.data.map(e=>({...e,open:"08:30 - 21:30"})),f.value=s.data.data.map(e=>({styleId:"marker",position:e.location,content:e.title}))})})}),(v,s)=>{const e=V("RouterLink"),p=V("RouterView");return u(),m("div",wt,[t("div",Ct,[k(z,{switchs:y.value},null,8,["switchs"]),k(Y,{class:"search",onClick:s[0]||(s[0]=c=>v.$router.push("/search"))})]),t("div",{class:"loc-box",onClick:s[1]||(s[1]=c=>v.$router.push("/location"))},[s[2]||(s[2]=t("span",{class:"iconfont icon-didiandingwei_o"},null,-1)),t("span",null,[t("span",xt,r(n.value.title),1),x(" | "+r(n.value.distance)+"m",1)]),s[3]||(s[3]=t("button",null,">",-1))]),t("div",Vt,[(u(),m(N,null,B(_,(c,g)=>k(e,{class:"link f-b",key:c.id,to:c.path},{default:C(()=>[x(r(c.title),1)]),_:2},1032,["to"])),64))]),t("div",qt,[k(p,null,{default:C(({Component:c,route:g})=>[(u(),h(H,null,[(u(),h(T(c),{key:g.fullPath}))],1024))]),_:1})]),R(a).cart.length?(u(),h(gt,{key:0,class:j(["w cart",{pos:v.$route.meta.showNav}])},null,8,["class"])):G("",!0)])}}},Ft=$(St,[["__scopeId","data-v-cea9af0a"]]);export{Ft as default};
