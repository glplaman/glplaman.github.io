import{u as I}from"./cart-DvsdMqz-.js";import{a as C,r as K,k as j,S as z}from"./Tabbar.vue_vue_type_style_index_0_scoped_ec820afd_lang-bFogEJa_.js";import{_ as y,o as d,c as _,a as t,u as A,b as U,r as u,F as D,d as F,n as g,w,t as r,e as E,f as x,g as M,h as S,v as V,i as N,j as h,k as G,l as B,m as R,p as q,K as L,q as P,s as H}from"./index-CFKXARzf.js";const J={},O={class:"search"},Q={class:"clear",ref:"clear-ref"};function W(m,e){return d(),_("div",O,[e[1]||(e[1]=t("span",{class:"iconfont icon-sousuo_o"},null,-1)),e[2]||(e[2]=t("input",{class:"ipt",type:"text",placeholder:"小黄杏美式"},null,-1)),t("div",Q,e[0]||(e[0]=[t("span",{class:"iconfont icon-guanbi_o"},null,-1)]),512)])}const X=y(J,[["render",W],["__scopeId","data-v-db721673"]]),Y={class:"tabbar",ref:"tabbar"},Z=["onClick"],tt={__name:"Tabbar",props:["tabs"],setup(m){const e=A();U();const i=u(0),a=n=>{e.push(n.path),i.value=n.ind};return(n,b)=>(d(),_("div",Y,[(d(!0),_(D,null,F(m.tabs,(p,v)=>(d(),_("button",{key:v,class:g(["tab-item",{active:i.value===v}]),onClick:w(k=>a(p),["stop"])},[t("h3",null,r(p.title),1)],10,Z))),128)),E(n.$slots,"default",{},void 0)],512))}},st=y(tt,[["__scopeId","data-v-ec820afd"]]),et={class:"cont"},at={class:"header"},nt={class:"all"},ot={for:"all"},lt=["value"],it=["src"],ct={class:"info"},rt={class:"title"},ut={class:"sub-title"},dt={class:"price-new"},pt={class:"price-old"},vt={class:"oper"},_t=["onClick"],ft={class:"num"},bt=["onClick"],ht={class:"cart-num f-s-s"},mt={class:"price"},kt={class:"total-price f-s-m f-b"},wt={class:"total-promotion f-s-s"},yt={__name:"Cart",setup(m){const e=u(!1),i=I(),a=u([...i.cart]),n=u(!0),b=u(0),p=u(0);let v=!0;x(a,()=>{a.value.length===i.cart.length?(n.value=!0,v=!0):(n.value=!1,v=!1),b.value=a.value.reduce((l,s)=>l+s.price*s.quantity*(1-s.discount),0),p.value=a.value.reduce((l,s)=>l+s.quantity,0)},{deep:!0,immediate:!0}),x(n,l=>{l?a.value=i.cart:v&&(a.value=[])});const k=()=>{i.clearCart(),a.value=[],n.value=!1},f=()=>{e.value=!1},o=()=>i.cart.reduce((l,s)=>l+s.price*s.discount*s.quantity,0);return M(()=>{console.log("cart loading",i.cart)}),(l,s)=>{const T=R("router-link");return d(),_("div",{class:g(["cart",{"show-cont-all":e.value}]),onClick:w(f,["self"])},[t("div",et,[t("header",at,[t("div",nt,[S(t("input",{type:"checkbox",id:"all","onUpdate:modelValue":s[0]||(s[0]=c=>n.value=c)},null,512),[[V,n.value]]),t("label",ot,"已选择商品（"+r(p.value)+"件）",1)]),t("button",{class:"clear",onClick:w(k,["stop"])},s[3]||(s[3]=[t("span",{class:"iconfont icon-shanchu_o"},null,-1),t("span",null,"清空购物车",-1)]))]),(d(!0),_(D,null,F(N(i).cart,(c,Vt)=>(d(),_("div",{class:"item",key:c.id},[S(t("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":s[1]||(s[1]=$=>a.value=$),value:c},null,8,lt),[[V,a.value]]),t("img",{class:"img",src:`https://glpla.github.io/utils${c.img}`,alt:""},null,8,it),t("div",ct,[t("h3",rt,r(c.name),1),t("div",ut,r(c.desc),1),t("div",null,[t("span",dt,"¥"+r(c.price),1),t("span",pt,"¥"+r(c.price_original),1)])]),t("div",vt,[t("button",{class:"btn dec",onClick:$=>c.quantity--},"-",8,_t),t("span",ft,r(c.quantity),1),t("button",{class:"btn inc",onClick:$=>c.quantity++},"+",8,bt)])]))),128))]),t("footer",null,[t("button",{class:"btn cart-left",onClick:s[2]||(s[2]=w(c=>e.value=!e.value,["stop"]))},[s[4]||(s[4]=t("span",{class:"iconfont icon-icon_ruixingkafei"},null,-1)),t("span",ht,r(p.value),1)]),t("div",mt,[t("div",null,[s[5]||(s[5]=t("span",null,"预计到手 ",-1)),t("span",kt,"¥"+r(b.value.toFixed(2)),1)]),t("div",wt,[s[6]||(s[6]=t("span",null,"已享受更多优惠，共减免 ",-1)),t("span",null,"¥"+r(o().toFixed(2)),1)])]),h(T,{class:"btn pay-btn f-s-b",to:"/order"},{default:G(()=>s[7]||(s[7]=[B("去结算")])),_:1})])],2)}}},$t=y(yt,[["__scopeId","data-v-6e637071"]]),gt={class:"menu-view p-b-10"},Ct={class:"header"},xt={class:"f-b"},St={__name:"MenuView",setup(m){const e=I(),i=H("axios"),a=u({}),n=u({}),b=u({}),p=u({}),v=[{ind:0,title:"经典菜单",path:"/menu",keyword:"classic"},{ind:1,title:"会员卡",path:"/menu/vip",keyword:"member"},{ind:2,title:"年度封神榜",path:"/menu/rank",keyword:"rank"},{ind:3,title:"我的常点",path:"/menu/favorite",keyword:"favor"}],k=u([{title:"自提"},{title:"外送"}]);return M(()=>{i.get(`/map-api/ws/location/v1/ip?ip=&key=${C}`).then(f=>{n.value=f.data.result.location||{lat:23.060754,lng:113.580752},i.get(`/map-api/ws/place/v1/search?boundary=nearby(${n.value.lat},${n.value.lng},${K})&keyword=${j}&page_size=10&page_index=1&key=${C}`).then(o=>{a.value={title:o.data.data[0].title.replace(/瑞幸咖啡\(/,"").replace(/\)/,""),distance:o.data.data[0]._distance.toFixed(0)},b.value=o.data.data.map(l=>({...l,open:"08:30 - 21:30"})),p.value=o.data.data.map(l=>({styleId:"marker",position:l.location,content:l.title}))})})}),(f,o)=>{const l=R("RouterView");return d(),_("div",gt,[t("div",Ct,[h(z,{switchs:k.value},null,8,["switchs"]),h(X,{class:"search",onClick:o[0]||(o[0]=s=>f.$router.push("/search"))})]),t("div",{class:"loc-box",onClick:o[1]||(o[1]=s=>f.$router.push("/location"))},[o[2]||(o[2]=t("span",{class:"iconfont icon-didiandingwei_o"},null,-1)),t("span",null,[t("span",xt,r(a.value.title),1),B(" | "+r(a.value.distance)+"m",1)]),o[3]||(o[3]=t("button",null,">",-1))]),h(st,{tabs:v}),(d(),q(L,null,[h(l,{class:"sub-view p-1"})],1024)),N(e).cart.length?(d(),q($t,{key:0,class:g(["w cart",{pos:f.$route.meta.showNav}])},null,8,["class"])):P("",!0)])}}},Ft=y(St,[["__scopeId","data-v-d73b4c67"]]);export{Ft as default};
