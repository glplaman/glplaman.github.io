import{u as S}from"./cart-B06A91Wi.js";import{a as q,r as A,k as K,S as L}from"./Switch-C6aOtZ8v.js";import{_ as $,o as u,c as f,a as t,m as U,u as z,w as M,v as I,t as d,r as v,b as P,d as E,e as D,f as b,g as x,F,h as N,i as m,j as B,k as h,n as R,l as V,p as y,q as G,s as O,x as T,K as H}from"./index-C7dosxJe.js";const J={},Q={class:"search"},W={class:"clear",ref:"clear-ref"};function X(n,s){return u(),f("div",Q,[s[1]||(s[1]=t("span",{class:"iconfont icon-sousuo_o"},null,-1)),s[2]||(s[2]=t("input",{class:"ipt",type:"text",placeholder:"小黄杏美式"},null,-1)),t("div",W,s[0]||(s[0]=[t("span",{class:"iconfont icon-guanbi_o"},null,-1)]),512)])}const Y=$(J,[["render",X],["__scopeId","data-v-db721673"]]),Z={class:"cart-item"},tt=["value"],et=["src"],st={class:"info"},at={class:"title"},nt={class:"sub-title"},lt={class:"price-new"},ot={class:"price-old"},it={class:"oper"},ct=["disabled"],rt={class:"num"},ut=["disabled"],dt={__name:"CartItem",props:U({cart:{type:Object,default:{}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const s=z(n,"modelValue");return(c,l)=>(u(),f("div",Z,[M(t("input",{type:"checkbox",name:"cart","onUpdate:modelValue":l[0]||(l[0]=r=>s.value=r),value:n.cart},null,8,tt),[[I,s.value]]),t("img",{class:"img",src:`https://glpla.github.io/utils${n.cart.img}`,alt:""},null,8,et),t("div",st,[t("h3",at,d(n.cart.name),1),t("div",nt,d(n.cart.desc),1),t("div",null,[t("span",lt,"¥"+d(n.cart.price),1),t("span",ot,"¥"+d(n.cart.price_original),1)])]),t("div",it,[t("button",{class:"btn dec",onClick:l[1]||(l[1]=r=>n.cart.quantity--),disabled:n.cart.quantity==1},"-",8,ct),t("span",rt,d(n.cart.quantity),1),t("button",{class:"btn inc",onClick:l[2]||(l[2]=r=>n.cart.quantity++),disabled:n.cart.quantity>=n.cart.stock},"+",8,ut)])]))}},vt=$(dt,[["__scopeId","data-v-2cda3e0a"]]),pt={class:"cont"},mt={class:"header"},ft={class:"all"},_t={class:"cart-num f-s-s"},kt={class:"price"},bt={class:"total-price f-s-m f-b"},yt={class:"total-promotion f-s-s"},ht={__name:"Cart",setup(n){const s=S(),c=v([...s.carts]),l=v(!1),r=v(!0),_=v(0),k=v(0);P(c,a=>{r.value=a.length===s.carts.length,_.value=c.value.reduce((e,o)=>e+o.quantity*o.price*(1-o.discount),0),k.value=c.value.reduce((e,o)=>e+o.quantity,0)},{deep:!0,immediate:!0});const w=()=>{r.value?c.value=[...s.carts]:c.value=[]},g=E(()=>c.value.reduce((e,o)=>e+o.quantity*o.price*o.discount,0).toFixed(2)),p=()=>{s.clearCarts(),c.value=[],r.value=!1};return D(()=>{console.log("cart loading",s.carts)}),(a,e)=>{const o=V("router-link");return u(),f("div",{class:R(["cart",{"show-cont-all":l.value}]),onClick:e[3]||(e[3]=x(i=>l.value=!1,["self"]))},[t("div",pt,[t("header",mt,[t("label",ft,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=i=>r.value=i),onChange:w},null,544),[[I,r.value]]),b(" 已选择商品（"+d(k.value)+"件）",1)]),t("button",{class:"clear",onClick:x(p,["stop"])},e[4]||(e[4]=[t("span",{class:"iconfont icon-shanchu_o"},null,-1),t("span",null,"清空购物车",-1)]))]),(u(!0),f(F,null,N(B(s).carts,(i,C)=>(u(),m(vt,{key:i.id,cart:i,modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=j=>c.value=j)},null,8,["cart","modelValue"]))),128))]),t("footer",null,[t("button",{class:"btn cart-left",onClick:e[2]||(e[2]=x(i=>l.value=!l.value,["stop"]))},[e[5]||(e[5]=t("span",{class:"iconfont icon-icon_ruixingkafei"},null,-1)),t("span",_t,d(k.value),1)]),t("div",kt,[t("div",null,[e[6]||(e[6]=t("span",null,"预计到手 ",-1)),t("span",bt,"¥"+d(_.value.toFixed(2)),1)]),t("div",yt,[e[7]||(e[7]=t("span",null,"已享受更多优惠，共减免 ",-1)),t("span",null,"¥"+d(g.value),1)])]),_.value?(u(),m(o,{key:0,class:"btn pay-btn f-s-m",to:"/order"},{default:h(()=>e[8]||(e[8]=[b("去结算")])),_:1})):(u(),m(o,{key:1,class:"btn pay-btn f-s-m",to:"/order"},{default:h(()=>e[9]||(e[9]=[b("不可结算")])),_:1}))])],2)}}},$t=$(ht,[["__scopeId","data-v-7a13c8ac"]]),wt={class:"menu-view"},gt={class:"header"},Ct={class:"f-b"},xt={class:"links"},Vt={class:"sub-view p-1"},qt={__name:"MenuView",setup(n){const s=S(),c=O("axios"),l=v({}),r=v({}),_=v({}),k=v({}),w=[{ind:0,title:"经典菜单",path:"/menu/goods",keyword:"classic"},{ind:1,title:"会员卡",path:"/menu/vip",keyword:"member"},{ind:2,title:"年度封神榜",path:"/menu/rank",keyword:"rank"},{ind:3,title:"我的常点",path:"/menu/favorite",keyword:"favor"}],g=v([{title:"自提"},{title:"外送"}]);return D(()=>{c.get(`/map-api/ws/location/v1/ip?ip=&key=${q}`).then(p=>{r.value=p.data.result.location||{lat:23.060754,lng:113.580752},c.get(`/map-api/ws/place/v1/search?boundary=nearby(${r.value.lat},${r.value.lng},${A})&keyword=${K}&page_size=10&page_index=1&key=${q}`).then(a=>{l.value={title:a.data.data[0].title.replace(/瑞幸咖啡\(/,"").replace(/\)/,""),distance:a.data.data[0]._distance.toFixed(0)},_.value=a.data.data.map(e=>({...e,open:"08:30 - 21:30"})),k.value=a.data.data.map(e=>({styleId:"marker",position:e.location,content:e.title}))})})}),(p,a)=>{const e=V("RouterLink"),o=V("RouterView");return u(),f("div",wt,[t("div",gt,[y(L,{switchs:g.value},null,8,["switchs"]),y(Y,{class:"search",onClick:a[0]||(a[0]=i=>p.$router.push("/search"))})]),t("div",{class:"loc-box",onClick:a[1]||(a[1]=i=>p.$router.push("/location"))},[a[2]||(a[2]=t("span",{class:"iconfont icon-didiandingwei_o"},null,-1)),t("span",null,[t("span",Ct,d(l.value.title),1),b(" | "+d(l.value.distance)+"m",1)]),a[3]||(a[3]=t("button",null,">",-1))]),t("div",xt,[(u(),f(F,null,N(w,(i,C)=>y(e,{class:"link f-b",key:i.id,to:i.path},{default:h(()=>[b(d(i.title),1)]),_:2},1032,["to"])),64))]),t("div",Vt,[y(o,null,{default:h(({Component:i,route:C})=>[(u(),m(H,null,[(u(),m(T(i),{key:C.fullPath}))],1024))]),_:1})]),B(s).carts.length?(u(),m($t,{key:0,class:R(["w cart",{pos:p.$route.meta.showNav}])},null,8,["class"])):G("",!0)])}}},Dt=$(qt,[["__scopeId","data-v-b618ce3a"]]);export{Dt as default};
