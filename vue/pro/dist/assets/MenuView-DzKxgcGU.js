import{u as F}from"./cart-BCLW_0x4.js";import{a as S,r as P,k as U,S as z}from"./Switch-CrFf1xCY.js";import{_ as g,o,c as m,a as t,m as T,u as E,w as N,v as R,t as u,r as v,b as G,d as H,e as B,f as V,g as C,F as O,h as j,i as h,j as A,n as K,k as J,l as $,p as q,q as x,K as M,s as Q,x as I,y as D}from"./index-CbtlGMhi.js";import{u as W}from"./order-tw0xl60s.js";const X={},Y={class:"search"},Z={class:"clear",ref:"clear-ref"};function tt(a,i){return o(),m("div",Y,[i[1]||(i[1]=t("span",{class:"iconfont icon-sousuo_o"},null,-1)),i[2]||(i[2]=t("input",{class:"ipt",type:"text",placeholder:"小黄杏美式"},null,-1)),t("div",Z,i[0]||(i[0]=[t("span",{class:"iconfont icon-guanbi_o"},null,-1)]),512)])}const et=g(X,[["render",tt],["__scopeId","data-v-db721673"]]),st={class:"cart-item"},at=["value"],nt=["src"],lt={class:"info"},ot={class:"title"},it={class:"sub-title"},ct={class:"price-new"},rt={class:"price-old"},ut={class:"oper"},dt=["disabled"],vt={class:"num"},pt=["disabled"],mt={__name:"CartItem",props:T({cart:{type:Object,default:{}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const i=E(a,"modelValue");return(d,c)=>(o(),m("div",st,[N(t("input",{type:"checkbox",name:"cart","onUpdate:modelValue":c[0]||(c[0]=s=>i.value=s),value:a.cart},null,8,at),[[R,i.value]]),t("img",{class:"img",src:`https://glpla.github.io/utils${a.cart.img}`,alt:""},null,8,nt),t("div",lt,[t("h3",ot,u(a.cart.title),1),t("div",it,u(a.cart.desc),1),t("div",null,[t("span",ct,"¥"+u(a.cart.price),1),t("span",rt,"¥"+u(a.cart.price_original),1)])]),t("div",ut,[t("button",{class:"btn dec",onClick:c[1]||(c[1]=s=>a.cart.quantity--),disabled:a.cart.quantity==1},"-",8,dt),t("span",vt,u(a.cart.quantity),1),t("button",{class:"btn inc",onClick:c[2]||(c[2]=s=>a.cart.quantity++),disabled:a.cart.quantity>=a.cart.stock},"+",8,pt)])]))}},ft=g(mt,[["__scopeId","data-v-48eef1e3"]]),_t={class:"cont"},kt={class:"header"},ht={class:"all"},yt={class:"cart-num f-s-s"},bt={class:"price"},$t={class:"total-price f-s-m f-b"},gt={class:"total-promotion f-s-s"},wt={key:1,class:"btn pay-btn f-s-m",t:""},Ct={__name:"Cart",setup(a){const i=J(),d=F(),c=W(),s=v([...d.carts]),k=v(!1),f=v(!0),y=v(0),b=v(0);G(s,r=>{f.value=r.length===d.carts.length,y.value=s.value.reduce((e,n)=>e+n.quantity*n.price*(1-n.discount),0),b.value=s.value.reduce((e,n)=>e+n.quantity,0)},{deep:!0,immediate:!0});const _=()=>{f.value?s.value=[...d.carts]:s.value=[]},l=H(()=>s.value.reduce((e,n)=>e+n.quantity*n.price*n.discount,0).toFixed(2)),p=()=>{d.clearCarts(),s.value=[],f.value=!1},w=()=>{c.gerTempOrder(s.value),i.push({name:"order"})};return B(()=>{console.log("cart loading",d.carts)}),(r,e)=>(o(),m("div",{class:K(["cart",{"show-cont-all":k.value}]),onClick:e[3]||(e[3]=C(n=>k.value=!1,["self"]))},[t("div",_t,[t("header",kt,[t("label",ht,[N(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),onChange:_},null,544),[[R,f.value]]),V(" 已选择商品（"+u(b.value)+"件）",1)]),t("button",{class:"clear",onClick:C(p,["stop"])},e[4]||(e[4]=[t("span",{class:"iconfont icon-shanchu_o"},null,-1),t("span",null,"清空购物车",-1)]))]),(o(!0),m(O,null,j(A(d).carts,(n,Ft)=>(o(),h(ft,{key:n.id,cart:n,modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=L=>s.value=L)},null,8,["cart","modelValue"]))),128))]),t("footer",null,[t("button",{class:"btn cart-left",onClick:e[2]||(e[2]=C(n=>k.value=!k.value,["stop"]))},[e[5]||(e[5]=t("span",{class:"iconfont icon-icon_ruixingkafei"},null,-1)),t("span",yt,u(b.value),1)]),t("div",bt,[t("div",null,[e[6]||(e[6]=t("span",null,"预计到手 ",-1)),t("span",$t,"¥"+u(y.value.toFixed(2)),1)]),t("div",gt,[e[7]||(e[7]=t("span",null,"已享受更多优惠，共减免 ",-1)),t("span",null,"¥"+u(l.value),1)])]),y.value?(o(),m("div",{key:0,class:"btn pay-btn f-s-m",onClick:w},"去结算")):(o(),m("div",wt,"不可结算"))])],2))}},xt=g(Ct,[["__scopeId","data-v-8032e711"]]),Vt={class:"menu-view"},St={class:"header"},qt={class:"f-b"},Mt={class:"links"},It={class:"sub-view p-1"},Dt={__name:"MenuView",setup(a){const i=F(),d=Q("axios"),c=v({}),s=v({}),k=v({}),f=v({}),y=[{ind:0,title:"经典菜单",path:"/menu/goods",keyword:"classic"},{ind:1,title:"会员卡",path:"/menu/vip",keyword:"member"},{ind:2,title:"年度封神榜",path:"/menu/rank",keyword:"rank"},{ind:3,title:"我的常点",path:"/menu/favorite",keyword:"favor"}],b=v([{title:"自提"},{title:"外送"}]);return B(()=>{d.get(`/map-api/ws/location/v1/ip?ip=&key=${S}`).then(_=>{s.value=_.data.result.location||{lat:23.060754,lng:113.580752},d.get(`/map-api/ws/place/v1/search?boundary=nearby(${s.value.lat},${s.value.lng},${P})&keyword=${U}&page_size=10&page_index=1&key=${S}`).then(l=>{c.value={title:l.data.data[0].title.replace(/瑞幸咖啡\(/,"").replace(/\)/,""),distance:l.data.data[0]._distance.toFixed(0)},k.value=l.data.data.map(p=>({...p,open:"08:30 - 21:30"})),f.value=l.data.data.map(p=>({styleId:"marker",position:p.location,content:p.title}))})})}),(_,l)=>{const p=I("RouterLink"),w=I("RouterView");return o(),m("div",Vt,[t("div",St,[$(z,{switchs:b.value},null,8,["switchs"]),$(et,{class:"search",onClick:l[0]||(l[0]=r=>_.$router.push("/search"))})]),t("div",{class:"loc-box",onClick:l[1]||(l[1]=r=>_.$router.push("/location"))},[l[2]||(l[2]=t("span",{class:"iconfont icon-didiandingwei_o"},null,-1)),t("span",null,[t("span",qt,u(c.value.title),1),V(" | "+u(c.value.distance)+"m",1)]),l[3]||(l[3]=t("button",null,">",-1))]),t("div",Mt,[(o(),m(O,null,j(y,(r,e)=>$(p,{class:"link f-b",key:r.id,to:r.path},{default:q(()=>[V(u(r.title),1)]),_:2},1032,["to"])),64))]),t("div",It,[$(w,null,{default:q(({Component:r,route:e})=>[(o(),h(M,null,[e.meta.keepalive?(o(),h(D(r),{key:e.fullPath})):x("",!0)],1024)),e.meta.keepalive?x("",!0):(o(),h(D(r),{key:e.fullPath}))]),_:1})]),(o(),h(M,null,[A(i).carts.length?(o(),h(xt,{key:0,class:K(["w cart",{pos:_.$route.meta.showNav}])},null,8,["class"])):x("",!0)],1024))])}}},jt=g(Dt,[["__scopeId","data-v-805e92d0"]]);export{jt as default};
