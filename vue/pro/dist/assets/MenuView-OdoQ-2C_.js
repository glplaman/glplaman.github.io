import{u as I}from"./cart-DUpFtvm4.js";import{a as V,r as K,k as L,S as U}from"./Switch-bzlSu5I_.js";import{_ as g,o as i,c as m,a as t,m as z,u as P,w as D,v as F,t as r,r as v,b as T,d as E,e as N,f as x,g as C,F as R,h as B,i as y,j as O,n as j,k as G,l as $,p as S,q as H,K as q,s as J,x as M,y as Q}from"./index-BerH3bZh.js";import{u as W}from"./order-BzAWxj6i.js";const X={},Y={class:"search"},Z={class:"clear",ref:"clear-ref"};function tt(a,l){return i(),m("div",Y,[l[1]||(l[1]=t("span",{class:"iconfont icon-sousuo_o"},null,-1)),l[2]||(l[2]=t("input",{class:"ipt",type:"text",placeholder:"小黄杏美式"},null,-1)),t("div",Z,l[0]||(l[0]=[t("span",{class:"iconfont icon-guanbi_o"},null,-1)]),512)])}const et=g(X,[["render",tt],["__scopeId","data-v-db721673"]]),st={class:"cart-item"},at=["value"],nt=["src"],ot={class:"info"},lt={class:"title"},it={class:"sub-title"},ct={class:"price-new"},rt={class:"price-old"},ut={class:"oper"},dt=["disabled"],vt={class:"num"},pt=["disabled"],mt={__name:"CartItem",props:z({cart:{type:Object,default:{}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const l=P(a,"modelValue");return(d,c)=>(i(),m("div",st,[D(t("input",{type:"checkbox",name:"cart","onUpdate:modelValue":c[0]||(c[0]=s=>l.value=s),value:a.cart},null,8,at),[[F,l.value]]),t("img",{class:"img",src:`https://glpla.github.io/utils${a.cart.img}`,alt:""},null,8,nt),t("div",ot,[t("h3",lt,r(a.cart.name),1),t("div",it,r(a.cart.desc),1),t("div",null,[t("span",ct,"¥"+r(a.cart.price),1),t("span",rt,"¥"+r(a.cart.price_original),1)])]),t("div",ut,[t("button",{class:"btn dec",onClick:c[1]||(c[1]=s=>a.cart.quantity--),disabled:a.cart.quantity==1},"-",8,dt),t("span",vt,r(a.cart.quantity),1),t("button",{class:"btn inc",onClick:c[2]||(c[2]=s=>a.cart.quantity++),disabled:a.cart.quantity>=a.cart.stock},"+",8,pt)])]))}},ft=g(mt,[["__scopeId","data-v-2cda3e0a"]]),_t={class:"cont"},ht={class:"header"},kt={class:"all"},bt={class:"cart-num f-s-s"},yt={class:"price"},$t={class:"total-price f-s-m f-b"},gt={class:"total-promotion f-s-s"},wt={key:1,class:"btn pay-btn f-s-m",t:""},Ct={__name:"Cart",setup(a){const l=G(),d=I(),c=W(),s=v([...d.carts]),h=v(!1),f=v(!0),k=v(0),b=v(0);T(s,u=>{f.value=u.length===d.carts.length,k.value=s.value.reduce((e,n)=>e+n.quantity*n.price*(1-n.discount),0),b.value=s.value.reduce((e,n)=>e+n.quantity,0)},{deep:!0,immediate:!0});const _=()=>{f.value?s.value=[...d.carts]:s.value=[]},o=E(()=>s.value.reduce((e,n)=>e+n.quantity*n.price*n.discount,0).toFixed(2)),p=()=>{d.clearCarts(),s.value=[],f.value=!1},w=()=>{c.gerTempOrder(s.value),l.push({name:"order"})};return N(()=>{console.log("cart loading",d.carts)}),(u,e)=>(i(),m("div",{class:j(["cart",{"show-cont-all":h.value}]),onClick:e[3]||(e[3]=C(n=>h.value=!1,["self"]))},[t("div",_t,[t("header",ht,[t("label",kt,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),onChange:_},null,544),[[F,f.value]]),x(" 已选择商品（"+r(b.value)+"件）",1)]),t("button",{class:"clear",onClick:C(p,["stop"])},e[4]||(e[4]=[t("span",{class:"iconfont icon-shanchu_o"},null,-1),t("span",null,"清空购物车",-1)]))]),(i(!0),m(R,null,B(O(d).carts,(n,Ft)=>(i(),y(ft,{key:n.id,cart:n,modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=A=>s.value=A)},null,8,["cart","modelValue"]))),128))]),t("footer",null,[t("button",{class:"btn cart-left",onClick:e[2]||(e[2]=C(n=>h.value=!h.value,["stop"]))},[e[5]||(e[5]=t("span",{class:"iconfont icon-icon_ruixingkafei"},null,-1)),t("span",bt,r(b.value),1)]),t("div",yt,[t("div",null,[e[6]||(e[6]=t("span",null,"预计到手 ",-1)),t("span",$t,"¥"+r(k.value.toFixed(2)),1)]),t("div",gt,[e[7]||(e[7]=t("span",null,"已享受更多优惠，共减免 ",-1)),t("span",null,"¥"+r(o.value),1)])]),k.value?(i(),m("div",{key:0,class:"btn pay-btn f-s-m",onClick:w},"去结算")):(i(),m("div",wt,"不可结算"))])],2))}},xt=g(Ct,[["__scopeId","data-v-8032e711"]]),Vt={class:"menu-view"},St={class:"header"},qt={class:"f-b"},Mt={class:"links"},It={class:"sub-view p-1"},Dt={__name:"MenuView",setup(a){const l=I(),d=J("axios"),c=v({}),s=v({}),h=v({}),f=v({}),k=[{ind:0,title:"经典菜单",path:"/menu/goods",keyword:"classic"},{ind:1,title:"会员卡",path:"/menu/vip",keyword:"member"},{ind:2,title:"年度封神榜",path:"/menu/rank",keyword:"rank"},{ind:3,title:"我的常点",path:"/menu/favorite",keyword:"favor"}],b=v([{title:"自提"},{title:"外送"}]);return N(()=>{d.get(`/map-api/ws/location/v1/ip?ip=&key=${V}`).then(_=>{s.value=_.data.result.location||{lat:23.060754,lng:113.580752},d.get(`/map-api/ws/place/v1/search?boundary=nearby(${s.value.lat},${s.value.lng},${K})&keyword=${L}&page_size=10&page_index=1&key=${V}`).then(o=>{c.value={title:o.data.data[0].title.replace(/瑞幸咖啡\(/,"").replace(/\)/,""),distance:o.data.data[0]._distance.toFixed(0)},h.value=o.data.data.map(p=>({...p,open:"08:30 - 21:30"})),f.value=o.data.data.map(p=>({styleId:"marker",position:p.location,content:p.title}))})})}),(_,o)=>{const p=M("RouterLink"),w=M("RouterView");return i(),m("div",Vt,[t("div",St,[$(U,{switchs:b.value},null,8,["switchs"]),$(et,{class:"search",onClick:o[0]||(o[0]=u=>_.$router.push("/search"))})]),t("div",{class:"loc-box",onClick:o[1]||(o[1]=u=>_.$router.push("/location"))},[o[2]||(o[2]=t("span",{class:"iconfont icon-didiandingwei_o"},null,-1)),t("span",null,[t("span",qt,r(c.value.title),1),x(" | "+r(c.value.distance)+"m",1)]),o[3]||(o[3]=t("button",null,">",-1))]),t("div",Mt,[(i(),m(R,null,B(k,(u,e)=>$(p,{class:"link f-b",key:u.id,to:u.path},{default:S(()=>[x(r(u.title),1)]),_:2},1032,["to"])),64))]),t("div",It,[$(w,null,{default:S(({Component:u,route:e})=>[(i(),y(q,null,[(i(),y(Q(u),{key:e.fullPath}))],1024))]),_:1})]),(i(),y(q,null,[O(l).carts.length?(i(),y(xt,{key:0,class:j(["w cart",{pos:_.$route.meta.showNav}])},null,8,["class"])):H("",!0)],1024))])}}},jt=g(Dt,[["__scopeId","data-v-79852b7a"]]);export{jt as default};
