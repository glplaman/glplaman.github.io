import{u as N}from"./cart-C2rmDFeJ.js";import{a as q,r as j,k as z,S as A}from"./Tabbar.vue_vue_type_style_index_0_scoped_07715eb8_lang-B5fhOAiu.js";import{_ as V,o as p,c as _,a as t,r as u,w as D,b as B,d as F,v as M,t as i,e as y,F as I,f as R,u as K,g as k,h as $,i as C,n as L,j as x,k as g,l as P,m as U,p as E,K as G}from"./index-BLs0lsws.js";const T={},H={class:"search"},J={class:"clear",ref:"clear-ref"};function O(S,o){return p(),_("div",H,[o[1]||(o[1]=t("span",{class:"iconfont icon-sousuo_o"},null,-1)),o[2]||(o[2]=t("input",{class:"ipt",type:"text",placeholder:"小黄杏美式"},null,-1)),t("div",J,o[0]||(o[0]=[t("span",{class:"iconfont icon-guanbi_o"},null,-1)]),512)])}const Q=V(T,[["render",O],["__scopeId","data-v-db721673"]]),W={class:"cont"},X={class:"header"},Y={class:"all"},Z={for:"all"},tt=["value"],st=["src"],et={class:"info"},at={class:"title"},nt={class:"sub-title"},ot={class:"price-new"},lt={class:"price-old"},it={class:"oper"},ct=["onClick"],rt={class:"num"},ut=["onClick"],dt={class:"cart-num f-s-s"},pt={class:"price"},vt={class:"total-price f-s-m f-b"},_t={class:"total-promotion f-s-s"},ft={__name:"Cart",setup(S){const o=u(!1),c=N(),l=u([...c.cart]),r=u(!0),m=u(0),f=u(0);let h=!0;D(l,()=>{l.value.length===c.cart.length?(r.value=!0,h=!0):(r.value=!1,h=!1),m.value=l.value.reduce((n,s)=>n+s.price*s.quantity*(1-s.discount),0),f.value=l.value.reduce((n,s)=>n+s.quantity,0)},{deep:!0,immediate:!0}),D(r,n=>{n?l.value=c.cart:h&&(l.value=[])});const b=()=>{c.clearCart(),l.value=[],r.value=!1},v=()=>{o.value=!1},a=()=>c.cart.reduce((n,s)=>n+s.price*s.discount*s.quantity,0);return B(()=>{console.log("cart loading",c.cart)}),(n,s)=>{const d=x("router-link");return p(),_("div",{class:L(["cart",{"show-cont-all":o.value}]),onClick:y(v,["self"])},[t("div",W,[t("header",X,[t("div",Y,[F(t("input",{type:"checkbox",id:"all","onUpdate:modelValue":s[0]||(s[0]=e=>r.value=e)},null,512),[[M,r.value]]),t("label",Z,"已选择商品（"+i(f.value)+"件）",1)]),t("button",{class:"clear",onClick:y(b,["stop"])},s[3]||(s[3]=[t("span",{class:"iconfont icon-shanchu_o"},null,-1),t("span",null,"清空购物车",-1)]))]),(p(!0),_(I,null,R(K(c).cart,(e,$t)=>(p(),_("div",{class:"item",key:e.id},[F(t("input",{type:"checkbox",name:"",id:"","onUpdate:modelValue":s[1]||(s[1]=w=>l.value=w),value:e},null,8,tt),[[M,l.value]]),t("img",{class:"img",src:`https://glpla.github.io/utils${e.img}`,alt:""},null,8,st),t("div",et,[t("h3",at,i(e.name),1),t("div",nt,i(e.desc),1),t("div",null,[t("span",ot,"¥"+i(e.price),1),t("span",lt,"¥"+i(e.price_original),1)])]),t("div",it,[t("button",{class:"btn dec",onClick:w=>e.quantity--},"-",8,ct),t("span",rt,i(e.quantity),1),t("button",{class:"btn inc",onClick:w=>e.quantity++},"+",8,ut)])]))),128))]),t("footer",null,[t("button",{class:"btn cart-left",onClick:s[2]||(s[2]=y(e=>o.value=!o.value,["stop"]))},[s[4]||(s[4]=t("span",{class:"iconfont icon-icon_ruixingkafei"},null,-1)),t("span",dt,i(f.value),1)]),t("div",pt,[t("div",null,[s[5]||(s[5]=t("span",null,"预计到手 ",-1)),t("span",vt,"¥"+i(m.value.toFixed(2)),1)]),t("div",_t,[s[6]||(s[6]=t("span",null,"已享受更多优惠，共减免 ",-1)),t("span",null,"¥"+i(a().toFixed(2)),1)])]),k(d,{class:"btn pay-btn f-s-b",to:"/order"},{default:$(()=>s[7]||(s[7]=[C("去结算")])),_:1})])],2)}}},ht=V(ft,[["__scopeId","data-v-6e637071"]]),kt={class:"menu-view"},mt={class:"header"},bt={class:"f-b"},wt={class:"links"},yt={class:"sub-view p-1"},gt={__name:"MenuView",setup(S){const o=N(),c=U("axios"),l=u({}),r=u({}),m=u({}),f=u({}),h=[{ind:0,title:"经典菜单",path:"/menu/goods",keyword:"classic"},{ind:1,title:"会员卡",path:"/menu/vip",keyword:"member"},{ind:2,title:"年度封神榜",path:"/menu/rank",keyword:"rank"},{ind:3,title:"我的常点",path:"/menu/favorite",keyword:"favor"}],b=u([{title:"自提"},{title:"外送"}]);return B(()=>{c.get(`/map-api/ws/location/v1/ip?ip=&key=${q}`).then(v=>{r.value=v.data.result.location||{lat:23.060754,lng:113.580752},c.get(`/map-api/ws/place/v1/search?boundary=nearby(${r.value.lat},${r.value.lng},${j})&keyword=${z}&page_size=10&page_index=1&key=${q}`).then(a=>{l.value={title:a.data.data[0].title.replace(/瑞幸咖啡\(/,"").replace(/\)/,""),distance:a.data.data[0]._distance.toFixed(0)},m.value=a.data.data.map(n=>({...n,open:"08:30 - 21:30"})),f.value=a.data.data.map(n=>({styleId:"marker",position:n.location,content:n.title}))})})}),(v,a)=>{const n=x("RouterLink"),s=x("RouterView");return p(),_("div",kt,[t("div",mt,[k(A,{switchs:b.value},null,8,["switchs"]),k(Q,{class:"search",onClick:a[0]||(a[0]=d=>v.$router.push("/search"))})]),t("div",{class:"loc-box",onClick:a[1]||(a[1]=d=>v.$router.push("/location"))},[a[2]||(a[2]=t("span",{class:"iconfont icon-didiandingwei_o"},null,-1)),t("span",null,[t("span",bt,i(l.value.title),1),C(" | "+i(l.value.distance)+"m",1)]),a[3]||(a[3]=t("button",null,">",-1))]),t("div",wt,[(p(),_(I,null,R(h,(d,e)=>k(n,{class:"link f-b",key:d.id,to:d.path},{default:$(()=>[C(i(d.title),1)]),_:2},1032,["to"])),64))]),t("div",yt,[k(s,null,{default:$(({Component:d,route:e})=>[(p(),g(G,null,[(p(),g(E(d),{key:e.fullPath}))],1024))]),_:1})]),K(o).cart.length?(p(),g(ht,{key:0,class:L(["w cart",{pos:v.$route.meta.showNav}])},null,8,["class"])):P("",!0)])}}},St=V(gt,[["__scopeId","data-v-cea9af0a"]]);export{St as default};
